<?xml version="1.0" ?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:Metadata>
		[Event(name="userConfigComplete", type="com.easyinsight.customupload.UploadConfigEvent")]
		[Event(name="userConfigCancel", type="com.easyinsight.customupload.UploadConfigEvent")]
	</mx:Metadata>
    <mx:Script><![CDATA[
        import com.easyinsight.genredata.ModuleAnalyzeEvent;
        import com.easyinsight.google.AuthSubNavWindow;
        import com.easyinsight.listing.DescriptorAnalyzeSource;

        import com.easyinsight.util.PopUpUtil;

        import mx.controls.Alert;
        import mx.managers.PopUpManager;

        private function gotTest():void {
            Alert.show(tokenService.test.lastResult as String);
        }

        private function test():void {
            tokenService.test.send(1);
        }

        private function gotAuthSubURL():void {
            var window:AuthSubNavWindow = new AuthSubNavWindow();
            window.googleURL = tokenService.getAuthSubURL.lastResult as String;
            PopUpManager.addPopUp(window, this, true);
            PopUpUtil.centerPopUp(window);
        }

        private function google():void {
            tokenService.getAuthSubURL.send();
        }

        private var _dataSourceClass:Class;


        public function set dataSourceClass(val:Class):void {
            _dataSourceClass = val;
        }

        private function create():void {
            uploadService.newExternalDataSource.send(new _dataSourceClass(), null);
        }

        private function created():void {
            var id:int = uploadService.newExternalDataSource.lastResult as int;
            dispatchEvent(new UploadConfigEvent(UploadConfigEvent.UPLOAD_CONFIG_COMPLETE, id));
            dispatchEvent(new ModuleAnalyzeEvent(new DescriptorAnalyzeSource(id, "Admin Stats")));
        }
        ]]></mx:Script>
    <mx:RemoteObject destination="userUpload" id="uploadService">
        <mx:method name="newExternalDataSource" result="created()"/>
    </mx:RemoteObject>
    <mx:RemoteObject destination="tokenService" id="tokenService">
        <mx:method name="getAuthSubURL" result="gotAuthSubURL()"/>
        <mx:method name="test" result="gotTest()"/>
    </mx:RemoteObject>
    <mx:HBox width="100%" horizontalAlign="center">
        <mx:Button label="Google" click="google()"/>
        <mx:Button label="Test" click="test()"/>
        <mx:Button label="Create" click="create()"/>
        <mx:Button label="Cancel" click="dispatchEvent(new UploadConfigEvent(UploadConfigEvent.UPLOAD_CONFIG_CANCEL))"/>
    </mx:HBox>
</mx:VBox>