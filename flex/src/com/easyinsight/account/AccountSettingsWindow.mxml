<?xml version="1.0" ?>
<util:EISlimWindow xmlns:util="com.easyinsight.util.*" xmlns:mx="http://www.adobe.com/2006/mxml"
                    creationComplete="userService.getAccountSettings.send(); groupService.getAccountGroups.send()">
    <mx:Script><![CDATA[
        import com.easyinsight.framework.User;
        import com.easyinsight.util.ProgressAlert;

        import mx.collections.ArrayCollection;
        import mx.managers.PopUpManager;

        [Bindable]
        private var apiEnabled:Boolean = false;

        private var settings:AccountAPISettings;

        [Bindable]
        private var publicDataEnabled:Boolean;

        [Bindable]
        private var sharingEnabled:Boolean;

        [Bindable]
        private var availableGroups:ArrayCollection;

        [Bindable]
        private var firstDayOfWeek:int;

        [Bindable]
        private var groupID:int;

        private function gotSettings():void {
            var accountSettings:AccountSettings = userService.getAccountSettings.lastResult as AccountSettings;
            apiEnabled = accountSettings.apiEnabled;
            publicDataEnabled = accountSettings.publicData;
            sharingEnabled = accountSettings.reportSharing;
            groupID = accountSettings.groupID;
            dateFormat = accountSettings.dateFormat;
            currencySymbol = accountSettings.currencySymbol;
            firstDayOfWeek = accountSettings.firstDayOfWeek;
        }

        private function save():void {
            var accountSettings:AccountSettings = new AccountSettings();
            accountSettings.apiEnabled = apiEnabledCheckbox.selected;
            accountSettings.publicData = publicDataCheckbox.selected;
            accountSettings.reportSharing = sharingCheckbox.selected;
            accountSettings.groupID = groupBox.selectedItem.groupID;
            accountSettings.dateFormat = dateBox.selectedItem.data;
            accountSettings.currencySymbol = currencySymbolInput.text;
            accountSettings.firstDayOfWeek = dayBox.selectedItem.data;
            ProgressAlert.alert(this, "Saving settings...", null, userService.saveAccountSettings);
            User.getInstance().dateFormat = accountSettings.dateFormat;
            userService.saveAccountSettings.send(accountSettings);
        }

        private function saved():void {
            PopUpManager.removePopUp(this);
        }

        private function gotGroups():void {
            availableGroups = groupService.getAccountGroups.lastResult as ArrayCollection;
        }

        private function cancel():void {
            PopUpManager.removePopUp(this);
        }

        [Bindable]
        private var currencySymbol:String;

        [Bindable]
        private var dateFormat:int;
        ]]></mx:Script>
    <mx:RemoteObject destination="accountAdmin" id="userService">
        <mx:method name="getAccountSettings" result="gotSettings()"/>
        <mx:method name="saveAccountSettings" result="saved()"/>
    </mx:RemoteObject>
    <mx:RemoteObject destination="groupService" id="groupService">
        <mx:method name="getAccountGroups" result="gotGroups()"/>
    </mx:RemoteObject>
    <mx:VBox paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="5">
        <mx:Form paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0">
            <mx:FormItem label="API Enabled:">
                <mx:CheckBox id="apiEnabledCheckbox" selected="{apiEnabled}"/>
            </mx:FormItem>
            <mx:FormItem label="Default Group for Users:">
                <util:SmartComboBox dataProvider="{availableGroups}" labelField="name" selectedValue="{groupID}" selectedProperty="groupID"
                        id="groupBox"/>
            </mx:FormItem>
            <mx:FormItem label="Public Data Source and Report Sharing Enabled:">
                <mx:CheckBox id="publicDataCheckbox" selected="{publicDataEnabled}"/>
            </mx:FormItem>
            <mx:FormItem label="Report Sharing Outside of Account Enabled:">
                <mx:CheckBox id="sharingCheckbox" selected="{sharingEnabled}"/>
            </mx:FormItem>
            <mx:FormItem label="Date Formatting:">
                <util:SmartComboBox id="dateBox" rowCount="6" selectedValue="{dateFormat}" selectedProperty="data">
                    <util:dataProvider>
                        <mx:Array>
                            <mx:Object label="MM/DD/YYYY (04/26/2010)" data="0"/>
                            <mx:Object label="YYYY-MM-DD (2010-26-04)" data="1"/>
                            <mx:Object label="DD-MM-YYYY (26-04-2010)" data="2"/>
                            <mx:Object label="DD/MM/YYYY (26/04/2010)" data="3"/>
                            <mx:Object label="DD.MM.YYYY (26.04.2010)" data="4"/>
                        </mx:Array>
                    </util:dataProvider>
                </util:SmartComboBox>
            </mx:FormItem>
            <mx:FormItem label="Currency Symbol">
                <mx:TextInput id="currencySymbolInput" maxChars="1" text="{currencySymbol}"/>
            </mx:FormItem>
            <mx:FormItem label="First Day of Week">
                <util:SmartComboBox id="dayBox" rowCount="6" selectedValue="{firstDayOfWeek}" selectedProperty="data">
                    <util:dataProvider>
                        <mx:Array>
                            <mx:Object label="Sunday" data="1"/>
                            <mx:Object label="Monday" data="2"/>
                            <mx:Object label="Tuesday" data="3"/>
                            <mx:Object label="Wednesday" data="4"/>
                            <mx:Object label="Thursday" data="5"/>
                            <mx:Object label="Friday" data="6"/>
                            <mx:Object label="Saturday" data="7"/>
                        </mx:Array>
                    </util:dataProvider>
                </util:SmartComboBox>
            </mx:FormItem>
        </mx:Form>
        <mx:HBox width="100%" horizontalAlign="center">
            <util:SaveButton label="Save" click="save()"/>
            <util:CancelButton label="Cancel" click="cancel()"/>
        </mx:HBox>
    </mx:VBox>
</util:EISlimWindow>