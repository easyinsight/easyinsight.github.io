<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:listing="com.easyinsight.listing.*"
         xmlns:util="com.easyinsight.util.*" width="100%" height="100%"
         implements="com.easyinsight.listing.IPerspective"
         backgroundColor="#DCE2F8" doubleClickEnabled="true" creationComplete="initListeners()">
    <mx:states>
        <mx:State name="notLoggedIn">
            <mx:RemoveChild target="{solutionBox}"/>
            <mx:AddChild relativeTo="{coreContent}">
                <listing:GottaLoginPage/>
            </mx:AddChild>
        </mx:State>
    </mx:states>
    <mx:Script>
		<![CDATA[
        import com.easyinsight.account.Account;
        import com.easyinsight.framework.LoginEvent;

        import mx.utils.URLUtil;

        import com.easyinsight.framework.User;

        import mx.managers.BrowserManager;
        import mx.events.ListEvent;
        import mx.managers.PopUpManager;
        import mx.collections.ArrayCollection;

        import com.easyinsight.listing.AnalyzeSource;

        [Bindable]
        [Embed(source="../../../../assets/help.png")]
        public var helpIcon:Class;

        [Bindable]
        private var availableSolutions:ArrayCollection;

        [Bindable]
        private var availableRowCount:int = 5;

        private function initListeners():void {
            User.getEventNotifier().addEventListener(LoginEvent.LOGIN, onLogin);
        }

        private function onLogin(event:LoginEvent):void {
            gotFocus();
        }

        private function onDoubleClick(event:ListEvent):void {
            var solution:Solution = event.currentTarget.selectedItem;
            var window:SolutionInstallationWindow = SolutionInstallationWindow(PopUpManager.createPopUp(this, SolutionInstallationWindow, true));
            window.solution = solution;
            PopUpManager.centerPopUp(window);
        }

        public function analyze():AnalyzeSource {
            return null;
        }

        public function gotFocus():void {
            var fragmentObject:Object = new Object();
            fragmentObject.page = "solutions";
            BrowserManager.getInstance().setTitle("Easy Insight - Solutions");
            var fragmentString:String = URLUtil.objectToString(fragmentObject);
            BrowserManager.getInstance().setFragment(fragmentString);
            var user:User = User.getInstance();
            if (user == null) {
                currentState = "notLoggedIn";
            } else {
                if (User.getInstance().getAccountType() == Account.FREE) {
                    currentState = "functionalityUnavailable";
                } else {
                    if (currentState != "") {
                        currentState = "";
                    }
                    solutionService.getSolutions.send();
                }
            }
        }

        public function lostFocus():void {
        }

        public function getDefaultAnalyzeState():Boolean {
            return false;
        }

        public function isKeywordSearchInstant():Boolean {
            return false;
        }

        private function gotAllSolutions():void {
            this.availableSolutions = solutionService.getSolutions.lastResult as ArrayCollection;
            this.availableRowCount = this.availableSolutions.length;
        }

        private function search():void {

        }
                        
        ]]>
	</mx:Script>
    <mx:RemoteObject destination="solutionService" id="solutionService">
        <mx:method name="getSolutions" result="gotAllSolutions()"/>
    </mx:RemoteObject>
    <mx:Box width="100%" height="5" backgroundColor="#254BD4" left="0" right="0"/>
    <mx:VBox width="100%" height="100%" paddingTop="10" paddingLeft="10" paddingRight="10" paddingBottom="10"
             id="coreContent">
        <mx:VBox width="100%" height="100%" id="solutionBox">
            <mx:HBox width="100%">
                <mx:ApplicationControlBar>
                    <mx:Label fontSize="14" text="Available Solutions"/>
                </mx:ApplicationControlBar>
                <mx:Spacer width="100%"/>
                <mx:HBox borderStyle="inset" borderThickness="1" paddingTop="5" paddingBottom="5" paddingLeft="5"
                         paddingRight="5">
                    <mx:TextInput id="searchText" keyUp="search()"/>
                    <mx:Button toolTip="Search" icon="@Embed(source='../../../../assets/view.png')" id="searchButton"/>
                </mx:HBox>
            </mx:HBox>
            <mx:DataGrid dataProvider="{availableSolutions}" width="100%" itemDoubleClick="onDoubleClick(event)">
                <mx:columns>
                    <util:EIDataGridColumn headerText="Solution Name" dataField="name"
                                           headerRenderer="com.easyinsight.groups.CustomGroupHeader"/>
                    <util:EIDataGridColumn headerText="Industry" dataField="industry" width="150"
                                       headerRenderer="com.easyinsight.groups.CustomGroupHeader"/>
                    <util:EIDataGridColumn headerText="Author" dataField="author" width="150"
                                       headerRenderer="com.easyinsight.groups.CustomGroupHeader"/>
                    <util:EIDataGridColumn headerText="" width="100"
                                       itemRenderer="com.easyinsight.solutions.AvailableSolutionIcons"/>
                </mx:columns>
            </mx:DataGrid>
        </mx:VBox>
    </mx:VBox>
</mx:VBox>
