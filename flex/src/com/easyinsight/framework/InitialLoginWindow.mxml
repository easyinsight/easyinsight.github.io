<?xml version="1.0" ?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*" horizontalAlign="center"
         verticalAlign="middle"
         width="100%" height="100%" verticalGap="20" creationComplete="onCreation()">
    <mx:Metadata>
        [Event(name="kpiTutorialNext", type="com.easyinsight.kpi.KPITutorialEvent")]
    </mx:Metadata>
    <mx:Script><![CDATA[
        import com.easyinsight.kpi.KPITutorialEvent;
        import com.easyinsight.util.ProgressAlert;

        import mx.controls.Alert;
        import mx.validators.Validator;

        private function onCreation():void {
            stage.addEventListener(KeyboardEvent.KEY_UP, onKey);
        }

        private function onKey(event:KeyboardEvent):void {
            if (event.keyCode == Keyboard.ENTER) {
                finish();
            }
        }

        private function finish():void {
            var passwordResults:Array = Validator.validateAll([ passwordValidator ]);
            if (passwordResults.length > 0) {
                passwordInput.setFocus();
                passwordInput.dispatchEvent(new MouseEvent(MouseEvent.MOUSE_OVER));
            }
            var confirmResults:Array = Validator.validateAll([ confirmValidator ]);
            if (confirmResults.length > 0) {
                confirmInput.setFocus();
                confirmInput.dispatchEvent(new MouseEvent(MouseEvent.MOUSE_OVER));
            }
            if (passwordInput.text == confirmInput.text) {
                ProgressAlert.alert(this, "Updating...", null, userService.updatePassword);
                userService.updatePassword.send(passwordInput.text);
            } else {
                Alert.show("The passwords didn't match.");
            }
        }

        private function updated():void {
            var result:String = userService.updatePassword.lastResult as String;
            if(result == null) {
                stage.removeEventListener(KeyboardEvent.KEY_UP, onKey);
                dispatchEvent(new KPITutorialEvent(KPITutorialEvent.NEXT));
            } else {
                Alert.show(result);
            }
        }
        ]]></mx:Script>
    <mx:RemoteObject destination="login" id="userService">
        <mx:method name="updatePassword" result="updated()"/>
    </mx:RemoteObject>
    <mx:VBox width="100%" height="100%" verticalGap="0">
        <mx:Box height="50%" width="100%"  backgroundColor="#000000" horizontalAlign="center" verticalAlign="middle">
            <mx:Text text="Let's change that initial password to something&#13;you can remember." fontSize="24" color="#FFFFFF"/>
        </mx:Box>
        <mx:VBox verticalAlign="middle" horizontalAlign="center" height="50%" width="100%" backgroundColor="#FFFFFF">
            <mx:Spacer height="100%"/>
            <mx:Form paddingTop="0" paddingBottom="0" paddingLeft="0" paddingRight="0">
                <mx:FormItem label="New Password:" fontSize="18">
                    <mx:TextInput id="passwordInput" fontSize="18" displayAsPassword="true"/>
                </mx:FormItem>
                <mx:FormItem label="Once More to Confirm:" fontSize="18">
                    <mx:TextInput id="confirmInput" fontSize="18" displayAsPassword="true"/>
                </mx:FormItem>
            </mx:Form>
            <mx:Spacer height="100%"/>
            <mx:HBox width="100%" horizontalAlign="center" paddingBottom="10">
                <util:SaveButton label="Finish" click="finish()" fontSize="14"/>
            </mx:HBox>
        </mx:VBox>
    </mx:VBox>
    <mx:StringValidator source="{passwordInput}" property="text" minLength="3" maxLength="20" id="passwordValidator"/>
    <mx:StringValidator source="{confirmInput}" property="text" minLength="3" maxLength="20" id="confirmValidator"/>
</mx:VBox>