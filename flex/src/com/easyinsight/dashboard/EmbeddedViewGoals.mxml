<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:analysis="analysis.*"
	width="100%" height="100%" creationComplete="onCreation()">
	<mx:Metadata>
		[Event(name="simpleAnalyze", type="com.easyinsight.dashboard.SimpleAnalyzeEvent")]		
	</mx:Metadata> 
	<mx:Script>
		<![CDATA[
        import com.easyinsight.goals.IGoalsModule;
			import mx.controls.Alert;
			import mx.events.ModuleEvent;
            import mx.messaging.events.MessageEvent;
            import mx.modules.IModuleInfo;
			import mx.modules.ModuleManager;	
                   
            private var dataView:DisplayObject;

        private var _prefix:String = "";

            
            private var moduleInfo:IModuleInfo;

        public function set prefix(value:String) {
            _prefix = value;
        }

            private function onCreation():void {
                //defConsumer.subtopic = String(definition.dataFeedID);
                //defConsumer.subscribe();
                moduleInfo = ModuleManager.getModule(_prefix + "/app/easyui-debug/MyGoalsModule.swf");
                moduleInfo.addEventListener(ModuleEvent.READY, moduleLoadHandler);
                moduleInfo.addEventListener(ModuleEvent.ERROR, moduleFailureHandler);
                moduleInfo.load();
            }
            
            private function moduleLoadHandler(event:ModuleEvent):void {
            	var viewFactory:IGoalsModule = moduleInfo.factory.create() as IGoalsModule;
            	this.dataView = viewFactory.createDisplayObject();
            	coreVBox.addChild(dataView);
            }

            private function moduleFailureHandler(event:ModuleEvent):void {
            	Alert.show(event.errorText);
            }

            
            private function returnToList():void {
				dispatchEvent(new ReturnToListEvent());                    	
            }

            private function onMessage(event:MessageEvent):void {
                var view:IView = dataView as IView;
                view.refreshData();
            }
        ]]>
	</mx:Script>
    <mx:Consumer id="defConsumer" destination="dataUpdates" message="onMessage(event)"/>
	<mx:VBox id="coreVBox" height="100%" width="100%">
	</mx:VBox>
</mx:VBox>
