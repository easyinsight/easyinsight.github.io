<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:listing="com.easyinsight.listing.*"
         xmlns:easyinsight="com.easyinsight.*"
         width="100%" verticalGap="0" top="0" bottom="0"
         height="38" implements="com.easyinsight.listing.IHeaderBar" paddingTop="0" paddingBottom="0" paddingLeft="0"
         paddingRight="0"
         styleName="gradientBackgroundX" borderThickness="0" borderStyle="solid" horizontalAlign="center">
    <mx:Metadata>
        [Event(name="listingChange", type="com.easyinsight.listing.ListingChangeEvent")]
        [Event(name="launchQuickSearch", type="com.easyinsight.listing.LaunchQuickSearchEvent")]
    </mx:Metadata>
    <mx:Style>
        .gradientBackgroundX {
            border-skin: ClassReference("com.easyinsight.util.GradientBackground");
            fillColors: #770000, #440000;
        }
    </mx:Style>
    <mx:Script>
		<![CDATA[
        import com.easyinsight.framework.ModulePerspective;
        import com.easyinsight.framework.PerspectiveInfo;
        import com.easyinsight.listing.IPerspective;
        import com.easyinsight.preferences.UIConfiguration;
        import com.easyinsight.preferences.UIOption;
        import com.easyinsight.skin.ApplicationSkin;

        import mx.binding.utils.BindingUtils;
        import mx.events.ItemClickEvent;
        import mx.states.RemoveChild;

        public function set headerBarBackgroundColor(value:uint):void {
            //setStyle("backgroundColor", value);
        }

        protected override function createChildren():void {
            super.createChildren();
            /*BindingUtils.bindProperty(this, "headerBarBackgroundColor", ApplicationSkin.instance(), "headerBarBackgroundColor");
             BindingUtils.bindProperty(this, "headerBarLogo", ApplicationSkin.instance(), "headerBarLogo");*/
        }

        [Bindable]
        private var loggedIn:Boolean = false;

        private static function findNode(targetPage:String, items:ArrayCollection):HeaderListingOption {
            for each (var obj:HeaderListingOption in items) {
                if (obj.label == targetPage) {
                    return obj;
                }
            }
            return null;
        }

        private var perspectiveMap:Object = new Object();

        private function getPerspective(type:int):IPerspective {
            var perspective:IPerspective = perspectiveMap[String(type)];
            if (perspective == null) {
                perspective = new ModulePerspective(new PerspectiveInfo(type));
                perspectiveMap[type] = perspective;
            }
            return perspective;
        }

        public function explicitChange(targetPage:String, properties:Object):void {

            var listingOption:HeaderListingOption = findNode(targetPage, nodes);
            if (listingOption != null) {
                toggleBar.selectedIndex = nodes.getItemIndex(listingOption);
                dispatchEvent(new ListingChangeEvent(getPerspective(listingOption.perspective), properties));
            }

        }

        private function choseButton(event:ItemClickEvent):void {
            var option:HeaderListingOption = event.item as HeaderListingOption;
            dispatchEvent(new ListingChangeEvent(getPerspective(option.perspective)));
        }
        ]]>
    </mx:Script>
    <mx:ArrayCollection id="nodes">
        <mx:Array>
            <listing:HeaderListingOption label="Home" perspective="{PerspectiveInfo.HOME_PAGE}"/>
            <listing:HeaderListingOption label="Account" perspective="{PerspectiveInfo.ACCOUNT}"/>
        </mx:Array>
    </mx:ArrayCollection>
    <mx:HBox width="1000">

        <mx:ToggleButtonBar buttonStyleName="topGrayButton" dataProvider="{nodes}" itemClick="choseButton(event)"
                            fontSize="24" height="38" selectedButtonTextStyleName="headerSelected"
                            top="0" bottom="0" id="toggleBar">
        </mx:ToggleButtonBar>
        <mx:Spacer width="100%"/>
        <!--<listing:SearchButton/>-->
        <easyinsight:NewLoggedOnStatus/>
    </mx:HBox>
</mx:HBox>
