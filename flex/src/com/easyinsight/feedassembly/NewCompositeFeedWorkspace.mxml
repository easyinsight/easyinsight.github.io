<?xml version="1.0" encoding="utf-8"?>
<FullScreenPage xmlns="com.easyinsight.*" xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%"
                xmlns:feedassembly="com.easyinsight.feedassembly.*"
                paddingTop="10" paddingLeft="10" paddingRight="10" paddingBottom="10">
	<mx:Script>
		<![CDATA[
        import com.easyinsight.administration.feed.FeedChangeEvent;
import mx.controls.Alert;
        import mx.events.CloseEvent;
import mx.managers.PopUpManager;
            import mx.collections.ArrayCollection;
            import com.easyinsight.analysis.AnalysisCloseEvent;

            [Bindable]
            private var _feedList:ArrayCollection;

            private var saveNeeded:Boolean;

			private function createdFeed(event:CompositeFeedSaveEvent):void {
			    workspace.compositeFeedID = event.feedID;
			}
			
			private function cancel():void {
                if (saveNeeded) {
                    Alert.show("You have unsaved changes. Are you sure you want to exit?", "Alert",
		                		Alert.OK | Alert.CANCEL, null, alertListener, null, Alert.CANCEL);
                }
			}

            private function alertListener(event:CloseEvent):void {
                if (event.detail == Alert.OK) {
                    dispatchEvent(new AnalysisCloseEvent(this));
                }
            }

            private function onFeedChange(event:FeedChangeEvent):void {
                saveNeeded = true;
            }
			
			private function save():void {
				var compositeFeedNodes:ArrayCollection = workspace.createNodes();
				var compositeFeedConnections:ArrayCollection = workspace.createEdges();
                var saveWindow:SaveCompositeFeedWindow = new SaveCompositeFeedWindow();
                saveWindow.compositeFeedNodes = compositeFeedNodes;
                saveWindow.compositeFeedConnections = compositeFeedConnections;
				saveWindow.addEventListener(CompositeFeedSaveEvent.COMPOSITE_FEED_SAVE, createdFeed);
                PopUpManager.addPopUp(saveWindow, this, true);
                PopUpManager.centerPopUp(saveWindow);
			}

            public function addFeeds(feedList:ArrayCollection):void {
                this._feedList = feedList;
            }
		]]>
	</mx:Script>	
	<mx:VBox width="100%" height="100%">
		<mx:HBox>
            <mx:Button id="saveButton" icon="@Embed(source='../../../../assets/floppy_disk.png')" click="save()"
                           toolTip="Save"/>
			<mx:Button id="wrapButton" icon="@Embed(source='../../../../assets/document_out.png')" click="cancel()"
                       toolTip="Close"/>
		</mx:HBox>
		<feedassembly:CompositeWorkspace id="workspace" width="100%" height="100%" feeds="{_feedList}" feedChange="onFeedChange(event)"/>
	</mx:VBox>
</FullScreenPage>
