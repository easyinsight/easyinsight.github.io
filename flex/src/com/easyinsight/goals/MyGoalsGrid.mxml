<?xml version="1.0" ?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="setup()" doubleClickEnabled="true">
    <mx:Metadata>
        [Event(name="goalDetailNav", type="com.easyinsight.goals.GoalDetailEvent")]
    </mx:Metadata>
    <mx:Script><![CDATA[
        import com.easyinsight.framework.User;

        import mx.collections.ArrayCollection;
        import mx.events.ListEvent;

        [Bindable]
        private var goals:ArrayCollection;

        [Bindable]
        private var rowCount:int;

        private var timer:Timer;

        public function gotFocus():void {
            goalService.getGoals.send();
        }

        private function setup():void {
            timer = new Timer(300000);
            timer.addEventListener(TimerEvent.TIMER, onTimer);
            timer.start();
        }

        private function onTimer(event:TimerEvent):void {
            if (User.getInstance() != null) {
                this.goals = goalService.getGoals.lastResult as ArrayCollection;
            }
        }

        private function gotGoals():void {
            this.goals = goalService.getGoals.lastResult as ArrayCollection;
            rowCount = this.goals.length;
        }

        private function onDoubleClick(event:ListEvent):void {
            var goal:GoalTreeNodeData = goals.getItemAt(event.rowIndex) as GoalTreeNodeData;
            dispatchEvent(new GoalDetailEvent(goal));
            //dispatchEvent(new AnalyzeEvent(new GoalDetailAnalyzeSource(goal)));
        }
]]></mx:Script>
    <mx:RemoteObject destination="goalService" id="goalService">
        <mx:method name="getGoals" result="gotGoals()"/>
    </mx:RemoteObject>
    <mx:DataGrid dataProvider="{goals}" id="goalsGrid" width="100%" height="100%" rowCount="{rowCount}" rowHeight="28" itemDoubleClick="onDoubleClick(event)">
        <mx:columns>
            <mx:DataGridColumn headerText="" dataField="name" itemRenderer="com.easyinsight.goals.GoalIconRenderer" width="30"/>
            <mx:DataGridColumn headerText="Goal Name" dataField="name" headerRenderer="com.easyinsight.groups.CustomGroupHeader"/>
            <mx:DataGridColumn headerText="Latest Value" dataField="name" itemRenderer="com.easyinsight.goals.GoalValueRenderer"
                               headerRenderer="com.easyinsight.groups.CustomGroupHeader" width="110"/>
            <mx:DataGridColumn headerText="Date" dataField="name" headerRenderer="com.easyinsight.groups.CustomGroupHeader"
                    itemRenderer="com.easyinsight.goals.GoalDateRenderer" width="80"/>
            <mx:DataGridColumn headerText="" dataField="com.easyinsight.goals.GoalControls" sortable="false"
                               itemRenderer="com.easyinsight.goals.GoalControls" width="30"/>
        </mx:columns>
    </mx:DataGrid>
</mx:VBox>