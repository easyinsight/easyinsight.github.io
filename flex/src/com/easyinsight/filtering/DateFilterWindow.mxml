<?xml version="1.0" ?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" backgroundColor="#FFFFFF"
           borderThickness="1" cornerRadius="8" dropShadowEnabled="true"
           borderStyle="solid" creationComplete="onCreation()" verticalScrollPolicy="off" horizontalScrollPolicy="off">
    <mx:Script><![CDATA[
        import com.easyinsight.analysis.AnalysisDefinition;
        import com.easyinsight.analysis.AnalysisItem;

        import mx.core.Application;

        import mx.effects.Move;

        import mx.effects.Parallel;
        import mx.effects.Resize;

        import mx.managers.PopUpManager;

        public var filterMetadata:FilterMetadata;

        private function addLastValue():void {
            useEffect(new GenericFilter(_feedID, _item, GenericFilter.LAST_VALUE, null, filterMetadata));
        }

        private function addFirstValue():void {
            useEffect(new GenericFilter(_feedID, _item, GenericFilter.FIRST_VALUE, null, filterMetadata));
        }

        private function addNullValue():void {
            useEffect(new GenericFilter(_feedID, _item, GenericFilter.NULL_VALUE, null, filterMetadata));
        }

        private function addFlatValue():void {
            useEffect(new FlatDateFilter(_feedID, _item, 0, 0, null, filterMetadata));
        }

        private function addFlatMonthValue():void {
            useEffect(new FlatMonthDateFilter(_feedID, _item, 0, 0, null, filterMetadata));
        }

        private function addMultiFlatValue():void {
            var w:RangeFilterWindow = new RangeFilterWindow();
            w.item = _item;
            w.feedID = _feedID;
            w.filterMetadata = filterMetadata;
            w.addEventListener(FilterCreationEvent.FILTER_CREATION, passThrough);
            w.x = this.x;
            w.y = this.y;
            PopUpManager.addPopUp(w, this, true);
            stage.removeEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
            PopUpManager.removePopUp(this);
        }

        private function passThrough(event:FilterCreationEvent):void {
            dispatchEvent(event);
        }

        private function addCutoffFilter():void {
            var filter:MonthCutoffFilter = new MonthCutoffFilter(_feedID, _item, 0, 0);
            dispatchEvent(new FilterCreationEvent(filter));
            stage.removeEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
            PopUpManager.removePopUp(this);
        }

        private var _item:AnalysisItem;
        private var _feedID:int;

        public function set feedID(value:int):void {
            _feedID = value;
        }

        public function set item(value:AnalysisItem):void {
            _item = value;
        }

        private var _report:AnalysisDefinition;

        public function set report(value:AnalysisDefinition):void {
            _report = value;
        }

        private function addAbsolute():void {
            useEffect(new SliderDateFilter(_feedID, _item, 0, 0, null, filterMetadata, _report));
        }

        private var a:FilterAnimation;

        public var transformContainer:TransformContainer;

        private function addRolling():void {
            useEffect(new RollingRangeFilter(_feedID, _item, null, filterMetadata));
        }

        private function useEffect(filter:IFilter) {
            stage.removeEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
            var a:FilterAnimation = new FilterAnimation();
            a.x = this.x;
            a.y = this.y;
            PopUpManager.removePopUp(this);
            PopUpManager.addPopUp(a, DisplayObject(Application.application));
            var parallel:Parallel = new Parallel();
            var move:Move = new Move(a);
            move.xFrom = this.x;
            move.yFrom = this.y;
            if (transformContainer.filterTile.getChildren().length > 0) {
                var obj:DisplayObject = transformContainer.filterTile.getChildAt(transformContainer.filterTile.getChildren().length - 1) as DisplayObject;
                var p:Point = new Point(obj.x + obj.width, obj.y);
                var g:Point = transformContainer.filterTile.localToGlobal(p);
                move.xTo = g.x + 20;
                move.yTo = g.y;
            } else {
                var p2:Point = new Point(transformContainer.x, transformContainer.y);
                var g2:Point = transformContainer.localToGlobal(p2);
                move.xTo = g2.x + 100;
                move.yTo = g2.y;
            }
            move.duration = 500;
            parallel.addChild(move);
            parallel.addEventListener("effectEnd", function(event:Event):void {
                dispatchEvent(new FilterCreationEvent(filter));
                PopUpManager.removePopUp(a);

            });
            parallel.play();
        }

        private function onMouseDown(event:MouseEvent):void {
            var point:Point = localToGlobal(new Point(event.localX, event.localY));
            var result:Boolean = hitTestPoint(point.x, point.y);
            if (!result) {
                stage.removeEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
                PopUpManager.removePopUp(this);
            }
        }

        private function onCreation():void {
            stage.addEventListener(MouseEvent.MOUSE_DOWN, onMouseDown, false, 0, true);
        }

        [Bindable]
        private var stackIndex:int;
        ]]></mx:Script>
    <mx:VBox id="coreBox" paddingTop="5" paddingBottom="5" paddingLeft="5" paddingRight="5" horizontalAlign="center" verticalGap="10"
            styleName="fallThroughFonts" verticalScrollPolicy="off" horizontalScrollPolicy="off">
        <mx:Label text="What type of filter do you want to create?" fontSize="16" color="#333333"/>
        <mx:HBox width="100%" horizontalAlign="center">
            <mx:VBox borderStyle="solid" click="addRolling()" mouseChildren="false"
                    buttonMode="true" useHandCursor="true"
                    id="multiValueBox"
                    rollOver="multiValueBox.setStyle('backgroundColor', 0x00C4F4)"
                    rollOut="multiValueBox.setStyle('backgroundColor', 0xFFFFFF)"
                    styleName="filterChoiceButton">
                <mx:Label text="Rolling" fontSize="14" fontWeight="bold" styleName="filterChoiceButtonText"/>
                <mx:Text text="Restrict this field to a rolling time window"
                        selectable="false" width="200" height="50"
                        textAlign="center" styleName="filterChoiceButtonText"/>
            </mx:VBox>

            <mx:VBox borderStyle="solid" click="addMultiFlatValue()" mouseChildren="false"
                     buttonMode="true" useHandCursor="true"
                     id="multiFlatValueBox"
                     rollOver="multiFlatValueBox.setStyle('backgroundColor', 0x00C4F4)"
                     rollOut="multiFlatValueBox.setStyle('backgroundColor', 0xFFFFFF)" styleName="filterChoiceButton">
                <mx:Label text="Range" fontSize="14" fontWeight="bold" styleName="filterChoiceButtonText"/>
                <mx:Text text="Restrict this field to a range of weeks, months, quarters, or years"
                             selectable="false" width="200" height="50"
                             textAlign="center" styleName="filterChoiceButtonText"/>
            </mx:VBox>
            <mx:VBox borderStyle="solid" dropShadowEnabled="false" click="addAbsolute()" mouseChildren="false"
                     buttonMode="true" useHandCursor="true"
                     id="singleValueBox"
                     rollOver="singleValueBox.setStyle('backgroundColor', 0x00C4F4)"
                     rollOut="singleValueBox.setStyle('backgroundColor', 0xFFFFFF)" styleName="filterChoiceButton">
                <mx:Label text="Absolute" fontSize="14" fontWeight="bold" styleName="filterChoiceButtonText"/>
                <mx:Text text="Restrict this field to a date within a certain fixed time range"
                             selectable="false" width="200" height="50"
                             textAlign="center" styleName="filterChoiceButtonText"/>
            </mx:VBox>
        </mx:HBox>
        <mx:ViewStack resizeToContent="true" selectedIndex="{stackIndex}" creationPolicy="all">
            <mx:Box>
                <mx:Button label="Show Me More Types of Filters" click="stackIndex = 1" styleName="flatSaveButton"/>
            </mx:Box>
            <mx:VBox>
                <mx:HBox>
                    <mx:VBox borderStyle="solid" click="addLastValue()" mouseChildren="false"
                            buttonMode="true" useHandCursor="true" 
                            id="patternValueBox"
                            rollOver="patternValueBox.setStyle('backgroundColor', 0x00C4F4)"
                            rollOut="patternValueBox.setStyle('backgroundColor', 0xFFFFFF)" styleName="filterChoiceButton">
                        <mx:Label text="Newest Date" fontWeight="bold" fontSize="14"/>
                        <mx:Text text="Restrict this field to the most recent date"
                                selectable="false" width="200" height="50"
                                textAlign="center" styleName="filterChoiceButtonText"/>
                    </mx:VBox>
                    <mx:VBox borderStyle="solid" click="addFirstValue()" mouseChildren="false"
                            buttonMode="true" useHandCursor="true" 
                            id="firstValueBox"
                            rollOver="firstValueBox.setStyle('backgroundColor', 0x00C4F4)"
                            rollOut="firstValueBox.setStyle('backgroundColor', 0xFFFFFF)" styleName="filterChoiceButton">
                        <mx:Label text="Oldest Date" fontWeight="bold" fontSize="14"/>
                        <mx:Text text="Restrict this field to the oldest date"
                                selectable="false" width="200" height="50"
                                textAlign="center" styleName="filterChoiceButtonText"/>
                    </mx:VBox>
                    <mx:VBox borderStyle="solid" click="addNullValue()" mouseChildren="false"
                            buttonMode="true" useHandCursor="true" borderColor="#000000" horizontalAlign="center"
                            id="nullValueBox"
                            rollOver="nullValueBox.setStyle('backgroundColor', 0x00C4F4)"
                            rollOut="nullValueBox.setStyle('backgroundColor', 0xFFFFFF)" styleName="filterChoiceButton">
                        <mx:Label text="No Date" fontSize="14" fontWeight="bold" styleName="filterChoiceButtonText"/>
                        <mx:Text text="Restrict this field to values where this date is not set"
                                selectable="false" width="200" height="50"
                                textAlign="center" styleName="filterChoiceButtonText"/>
                    </mx:VBox>
                </mx:HBox>
                <mx:HBox width="100%" horizontalAlign="center" id="bottomBox">
                    <mx:VBox borderStyle="solid" click="addFlatValue()" mouseChildren="false"
                            buttonMode="true" useHandCursor="true" 
                            id="flatValueBox"
                            rollOver="flatValueBox.setStyle('backgroundColor', 0x00C4F4)"
                            rollOut="flatValueBox.setStyle('backgroundColor', 0xFFFFFF)" styleName="filterChoiceButton">
                        <mx:Label text="Year" fontSize="14" fontWeight="bold" styleName="filterChoiceButtonText"/>
                        <mx:Text text="Restrict this field to a single year"
                                selectable="false" width="200" height="50"
                                textAlign="center" styleName="filterChoiceButtonText"/>
                    </mx:VBox>
                    <mx:VBox borderStyle="solid" click="addFlatMonthValue()" mouseChildren="false"
                            buttonMode="true" useHandCursor="true" 
                            id="singleMonthFlatValueBox"
                            rollOver="singleMonthFlatValueBox.setStyle('backgroundColor', 0x00C4F4)"
                            rollOut="singleMonthFlatValueBox.setStyle('backgroundColor', 0xFFFFFF)" styleName="filterChoiceButton">
                        <mx:Label text="Single Month" fontWeight="bold" fontSize="14" styleName="filterChoiceButtonText"/>
                        <mx:Text text="Restrict this field to one month"
                                selectable="false" width="200" height="50"
                                textAlign="center" styleName="filterChoiceButtonText"/>
                    </mx:VBox>
                </mx:HBox>
            </mx:VBox>
        </mx:ViewStack>
    </mx:VBox>
</mx:Canvas>