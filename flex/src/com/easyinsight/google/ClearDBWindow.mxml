<?xml version="1.0"?>
<util:EISlimWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*"
        creationComplete="setup()">
    <mx:Script><![CDATA[
        import com.easyinsight.customupload.UploadConfigEvent;
        import com.easyinsight.quicksearch.EIDescriptor;

        import com.easyinsight.util.ProgressAlert;

        import mx.controls.Alert;
        import mx.managers.PopUpManager;
        import mx.validators.Validator;

        private function setup():void {
            addEventListener(KeyboardEvent.KEY_UP, function(event:KeyboardEvent):void {
                if (event.keyCode == Keyboard.ENTER) {
                    obtainTicket();
                }
            });
        }

        private function obtainTicket():void {
            var results:Array = Validator.validateAll([userNameValidator, passwordValidator]);
            if (results.length == 0) {
                ProgressAlert.alert(this, "Communicating with ClearDB...", null, quickbaseService.createClearDBDataSource);
                quickbaseService.createClearDBDataSource.send(userNameInput.text, passwordInput.text, accountVisibleCheckbox.selected);
            }
        }

        private function createdDataSource():void {
            var response:ClearDBResponse = quickbaseService.createClearDBDataSource.lastResult as ClearDBResponse;
            if (response.successful) {
                var descriptor:EIDescriptor = response.eiDescriptor;
                dispatchEvent(new UploadConfigEvent(UploadConfigEvent.UPLOAD_CONFIG_COMPLETE, descriptor.id, descriptor.name));
                PopUpManager.removePopUp(this);
            } else {
                Alert.show(response.errorMessage);
            }
        }
        ]]></mx:Script>
    <mx:RemoteObject destination="google" id="quickbaseService">
        <mx:method name="createClearDBDataSource" result="createdDataSource()"/>
    </mx:RemoteObject>
    <mx:VBox horizontalAlign="center">
        <mx:TextArea text="For Easy Insight to connect to ClearDB, you must grant READ permissions to the API key used below for your ClearDB database."
                editable="false" selectable="false" focusEnabled="false" width="500" height="50" fontSize="12"/>
        <mx:Form>
            <mx:FormItem label="ClearDB App ID" direction="horizontal" fontSize="14" fontWeight="normal" fontFamily="Lucida Grande">
                <mx:TextInput id="passwordInput" width="400"/>
                <mx:Label text="Where can I find this?" fontSize="10" textDecoration="underline" toolTip="Your App ID is found in the ClearDB user interface under App Details."/>
            </mx:FormItem>
            <mx:FormItem label="ClearDB API Key:" direction="horizontal" fontSize="14" fontWeight="normal" fontFamily="Lucida Grande">
                <mx:TextInput id="userNameInput" width="400"/>
                <mx:Label text="Where can I find this?" fontSize="10" textDecoration="underline" toolTip="You'll need to define an API key in the ClearDB user interface with adequate read rules for Easy Insight to perform SHOW TABLES, DESCRIBE, and SELECT operations."/>
            </mx:FormItem>
        </mx:Form>
        <mx:Form>
            <mx:FormItem label="Do you want to share this report with other users in the account?" fontSize="14" fontWeight="normal" fontFamily="Lucida Grande">
                <mx:CheckBox id="accountVisibleCheckbox" selected="true"/>
            </mx:FormItem>
        </mx:Form>
        <mx:HBox>
            <mx:Button label="Create" click="obtainTicket()" styleName="grayButton" fontSize="14"/>
            <mx:LinkButton label="Cancel" click="PopUpManager.removePopUp(this)" textDecoration="underline" fontSize="14"/>
        </mx:HBox>
    </mx:VBox>
    <mx:StringValidator id="userNameValidator" minLength="1" source="{userNameInput}" property="text"/>
    <mx:StringValidator id="passwordValidator" minLength="1" source="{passwordInput}" property="text"/>
</util:EISlimWindow>
