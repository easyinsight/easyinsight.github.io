<?xml version="1.0" ?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:groups="com.easyinsight.groups.*" paddingLeft="5" paddingBottom="5" paddingRight="5" paddingTop="5"
        width="100%">
    <mx:Script><![CDATA[
        import com.easyinsight.administration.feed.TagCloud;

        private var _groupID:int;

        [Bindable]
        private var _groupAdmin:Boolean;

        public function set groupAdmin(value:Boolean):void {
            _groupAdmin = value;
            stackIndex = _groupAdmin ? 1 : 0;
        }

        [Bindable]
        private var stackIndex:int = 0;

        private var _group:Group;
        [Bindable]
        private var groupName:String;
        [Bindable]
        private var description:String;
        [Bindable]
        private var hasDescription:Boolean;

        [Bindable]
        private var changesIndex:int = 0;

        private function onChange(event:Event):void {
            changesIndex = 1;
        }

        [Bindable]
        private var tags:String;

        [Bindable]
        private var publiclyVisible:Boolean;

        [Bindable]
        private var anyoneCanJoin:Boolean;

        [Bindable]
        private var ownerText:String;

        [Bindable]
        private var ownerLabel:String = "Group Owner:";

        public function set group(value:Group):void {
            if (_group != value && value != null) {
                _group = value;
                invalidateProperties();
            }
        }

        private function saveChanges():void {
            _group.name = groupNameInput.text;
            _group.description = descriptionInput.text;
            _group.tags = TagCloud.fromString(tagsInput.text);
            _group.publiclyJoinable = anyoneCanJoinCheckbox.selected;
            _group.publiclyVisible = publiclyVisibleCheckbox.selected;
            groupService.updateGroup.send(_group);
        }

        private function updatedGroup():void {
            changesIndex = 0;
        }

        protected override function commitProperties():void {
            super.commitProperties();
            if (_group != null) {
                this.groupName = _group.name;
                _groupID = _group.groupID;
                this.description = _group.description;
                if (description != null && description.length > 0) {
                    hasDescription = true;
                }
                ownerText = "";
                var secondUser:Boolean = false;
                for each (var groupUser:GroupUser in _group.groupUsers) {
                    if (groupUser.role == GroupUser.OWNER) {
                        if (secondUser) {
                            ownerText += ", ";
                        }
                        ownerText += "<b>" + groupUser.name + "</b>";
                        ownerText += ",";
                    }
                }
                ownerText = ownerText.substring(0, ownerText.length - 1);
                if (secondUser && ownerText != "") {
                    ownerLabel = "Group Owners:";
                }
                tags = TagCloud.toString(_group.tags);
                publiclyVisible = _group.publiclyVisible;
                anyoneCanJoin = _group.publiclyJoinable;
            }
        }]]></mx:Script>
    <mx:RemoteObject id="groupService" destination="groupService">
		<mx:method name="updateGroup" result="updatedGroup()"/>
	</mx:RemoteObject>
    <mx:VBox width="100%" horizontalAlign="center">
        <mx:Box width="100%" horizontalAlign="center" backgroundColor="#848080"
                paddingTop="5"
                paddingBottom="5">
            <mx:Label text="Group Info" fontSize="20" fontFamily="Tahoma" fontWeight="bold" color="#FFFFFF"/>
        </mx:Box>
        <mx:ViewStack selectedIndex="{changesIndex}" resizeToContent="true">
            <mx:Box/>
            <mx:HBox width="100%" horizontalAlign="center">
                <mx:HBox verticalAlign="middle" backgroundColor="#DDDDDD" cornerRadius="5" borderStyle="solid" borderColor="#DDDDDD" borderThickness="1"
                        paddingLeft="10" paddingTop="5" paddingBottom="5" paddingRight="10">
                    <mx:Label text="You have unsaved changes:"/>
                    <mx:Button label="Save Changes" click="saveChanges()"/>
                </mx:HBox>
            </mx:HBox>
        </mx:ViewStack>
        <mx:Form paddingTop="0" paddingLeft="0" paddingRight="0" paddingBottom="0">
            <mx:FormItem label="Name:" fontFamily="Tahoma" fontWeight="bold">
                <mx:ViewStack selectedIndex="{stackIndex}" resizeToContent="true">
                    <mx:Box>
                        <mx:Label text="{groupName}" fontFamily="Lucida Grande" fontWeight="normal"/>
                    </mx:Box>
                    <mx:Box>
                        <mx:TextInput text="{groupName}" fontFamily="Lucida Grande" fontWeight="normal" id="groupNameInput" change="onChange(event)"/>
                    </mx:Box>
                </mx:ViewStack>
            </mx:FormItem>
            <mx:FormItem label="Description:" fontFamily="Tahoma" fontWeight="bold">
                <mx:ViewStack selectedIndex="{stackIndex}" resizeToContent="true">
                    <mx:Box>
                        <mx:TextArea editable="false" text="{description}" fontFamily="Lucida Grande"
                             fontWeight="normal" height="100"/>
                    </mx:Box>
                    <mx:Box>
                        <mx:TextArea editable="true" text="{description}" fontFamily="Lucida Grande"
                             fontWeight="normal" height="100" id="descriptionInput" change="onChange(event)"/>
                    </mx:Box>
                </mx:ViewStack>
            </mx:FormItem>
            <mx:FormItem label="{ownerLabel}" fontFamily="Tahoma" fontWeight="bold">
                <mx:Label htmlText="{ownerText}" fontFamily="Lucida Grande" fontWeight="normal"/>
            </mx:FormItem>
            <mx:FormItem label="Tags:">
                <mx:ViewStack selectedIndex="{stackIndex}" resizeToContent="true">
                    <mx:Box>
                        <mx:Label text="{tags}" width="100%"/>
                    </mx:Box>
                    <mx:Box>
                        <mx:TextInput text="{tags}" id="tagsInput" width="100%" change="onChange(event)"/>
                    </mx:Box>
                </mx:ViewStack>
			</mx:FormItem>
			<mx:FormItem label="Publicly Visible:">
				<mx:CheckBox selected="{publiclyVisible}" id="publiclyVisibleCheckbox" enabled="{_groupAdmin}" change="onChange(event)"/>
			</mx:FormItem>
			<mx:FormItem label="Anyone Can Join:">
				<mx:CheckBox selected="{anyoneCanJoin}" id="anyoneCanJoinCheckbox" enabled="{_groupAdmin}" change="onChange(event)"/>
			</mx:FormItem>
        </mx:Form>
    </mx:VBox>
    <mx:VBox>

    </mx:VBox>
</mx:HBox>