<?xml version="1.0" ?>
<mx:Module xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:ilog="http://www.ilog.com/2007/ilog/flex"
           implements="com.easyinsight.analysis.IReportRenderer" width="100%" height="100%">
    <mx:Script><![CDATA[
        import com.easyinsight.analysis.AnalysisDefinition;
        import com.easyinsight.analysis.CustomChangeEvent;
        import com.easyinsight.filtering.FilterRawData;

        import mx.collections.ArrayCollection;

        [Bindable]
        private var tasks:ArrayCollection;

        [Bindable]
        private var resources:ArrayCollection;

        [Bindable]
        private var startTime:String;

        [Bindable]
        private var endTime:String;

        [Bindable]
        private var labelField:String;

        [Bindable]
        private var fullLabel:String;

        [Bindable]
        private var startDate:Date;

        [Bindable]
        private var endDate:Date;

        public function renderReport(dataSet:ArrayCollection, analysisDefinition:AnalysisDefinition, clientProcessorMap:Object, additionalProperties:Object):void {
            var gantt:GanttReport = analysisDefinition as GanttReport;
            if (dataSet.length > 0) {
                labelField = gantt.grouping.qualifiedName();
                fullLabel = gantt.grouping.display;
                startTime = gantt.startTime.qualifiedName();
                endTime = gantt.endTime.qualifiedName();
                this.startDate = null;
                this.endDate = null;
                for each (var obj:Object in dataSet) {
                    var startDate:Date = obj[gantt.startTime.qualifiedName()] as Date;
                    var endDate:Date = obj[gantt.endTime.qualifiedName()] as Date;
                    if (this.startDate == null || this.startDate > startDate) {
                        this.startDate = startDate;
                    }
                    if (this.endDate == null || this.endDate < endDate) {
                        this.endDate = endDate;
                    }
                }
                this.resources = dataSet;
                this.tasks = dataSet;
            }
        }

        public function createFilterRawData():FilterRawData {
            return null;
        }

        public function updateExportMetadata():void {
        }

        public function onCustomChangeEvent(event:CustomChangeEvent):void {
        }

        public function preserveValues():Boolean {
            return false;
        }]]></mx:Script>
    <ilog:ResourceChart id="resourceChart" width="100%" height="100%" taskEndTimeField="{endTime}"
                        taskStartTimeField="{startTime}" taskLabelField="{fullLabel}"
                        resourceDataProvider="{resources}" taskDataProvider="{tasks}" resourceIdField="{labelField}"
                        taskResourceIdField="{labelField}">
        <ilog:dataGrid>
            <ilog:GanttDataGrid>
                <ilog:columns>
                    <mx:AdvancedDataGridColumn dataField="{labelField}"
                                               headerText="{fullLabel}"/>
                </ilog:columns>
            </ilog:GanttDataGrid>
        </ilog:dataGrid>
        <ilog:ganttSheet>
            <ilog:GanttSheet
                      visibleTimeRangeStart="{startDate}"
                      visibleTimeRangeEnd="{endDate}" />
            
        </ilog:ganttSheet>

    </ilog:ResourceChart>
</mx:Module>