<?xml version="1.0" encoding="utf-8"?>
<util:EITitleWindow xmlns:util="com.easyinsight.util.*" xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:analysis="com.easyinsight.analysis.list.*"
                title="Tree Configuration" creationComplete="onCreation()">
    <mx:Script>
		<![CDATA[
        import com.easyinsight.analysis.AnalysisItemUpdateEvent;
        import com.easyinsight.analysis.ReportFormItem;

        import mx.collections.ArrayCollection;
        import mx.managers.PopUpManager;

        private var definition:HeatMapDefinition;

        [Bindable]
        private var availableFields:ArrayCollection;

        [Bindable]
        private var limitsEnabled:Boolean;

        [Bindable]
        private var customLimitEnabled:Boolean;

        public function set heatMapDefinition(treeDefinition:HeatMapDefinition):void {
            this.definition = treeDefinition;
            pointReportID = definition.pointReportID;
        }

        protected override function commitProperties():void {
            super.commitProperties();
            reportItems = new ArrayCollection();
            for each (var formItem:ReportFormItem in definition.createFormItems()) {
                form.addChild(formItem);
                reportItems.addItem(formItem);
            }
        }

        private function onCreation():void {
            analysisService.getInsightDescriptorsForDataSource.send(definition.dataFeedID);
        }

        private var reportItems:ArrayCollection;

        public function save():void {
            for each (var reportFormItem:ReportFormItem in reportItems) {
                reportFormItem.save();
            }
            definition.pointReportID = pointComboBox.selectedItem.id;
            dispatchEvent(new AnalysisItemUpdateEvent());
            PopUpManager.removePopUp(this);
        }

        public function cancel():void {
            PopUpManager.removePopUp(this);
        }

        private function gotReports():void {
            var reports:ArrayCollection = analysisService.getInsightDescriptorsForDataSource.lastResult as ArrayCollection;
            var nothing:Object = { id: 0, name: "[ No Report ]"};
            reports.addItemAt(nothing, 0);
            this.reports = reports;
        }

        [Bindable]
        private var reports:ArrayCollection;

        [Bindable]
        private var pointReportID:int;
		]]>
    </mx:Script>
    <mx:RemoteObject destination="analysisDefinition" id="analysisService">
        <mx:method name="getInsightDescriptorsForDataSource" result="gotReports()"/>
    </mx:RemoteObject>
    <mx:VBox paddingLeft="5" paddingRight="5" paddingTop="5" paddingBottom="5">
    <mx:Form id="form" paddingLeft="0" paddingRight="0" paddingTop="0" paddingBottom="0">
        <mx:FormItem label="Show This Report when User Clicks on Points:">
            <util:SmartComboBox id="pointComboBox" dataProvider="{reports}" labelField="name" selectedValue="{pointReportID}"
                                selectedProperty="id"/>
        </mx:FormItem>
    </mx:Form>
        <mx:HBox width="100%" horizontalAlign="center">
            <mx:Button label="Save" click="save()"/>
            <mx:Button label="Cancel" click="cancel()"/>
        </mx:HBox>
    </mx:VBox>
</util:EITitleWindow>
