<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:widget="http://www.netvibes.com/ns/">
<head>

    <meta name="author" content="Easy Insight"/>
    <meta name="description" content="Easy Insight Reporting Widget"/>
    <meta name="inline" content="true" />
    <meta name="autoRefresh" content="20" />
    <meta name="debugMode" content="true" />    

    <link rel="stylesheet" type="text/css"
          href="http://www.netvibes.com/themes/uwa/style.css"/>
    <script type="text/javascript"
            src="http://www.netvibes.com/js/UWA/load.js.php?env=Standalone"></script>

    <widget:preferences>
        <preference name="userName" type="text" label="User Name" defaultValue=""/>
        <preference name="password" type="password" label="Password" defaultValue=""/>
        <preference name="insightCombo" type="text" label="Insight" defaultValue="" />
        <preference name="reportName" type="text" label="Report Name" defaultValue="" />
        <preference name="reportType" type="text" label="Report Type" defaultValue="" />
    </widget:preferences>


    <title>Easy Insight</title>
    <link rel="icon" type="image/png"
          href="http://www.netvibes.com/favicon.ico"/>
    <script type="text/javascript">
        // widget.onLoad() is fired when the widget is fully loaded
        // or when the preferences are validated
        widget.onLoad = function() {
          var contentHtml = '';
            var queryString = window.location.search;
          if(queryString.length > 1)
            queryString = queryString.substring(1, queryString.length);
            var keyPairs = parseQueryString(queryString);
            if(keyPairs["insightCombo"] == null && keyPairs["reportName"] == null && keyPairs["reportType"] == null) {
                var realUrl;
                if(keyPairs["uwaUrl"] != null) {
                    realUrl = unescape(keyPairs["uwaUrl"]);
                }
                if(keyPairs["moduleUrl"] != null) {
                    realUrl = unescape(keyPairs["moduleUrl"]);
                }
                if(realUrl != null) {
                    var qs = realUrl.split("?");
                    if(qs.length == 2) {
                        qs = qs[1];
                        keyPairs = parseQueryString(qs);
                    }
                }
            }

          if(widget.getValue("insightCombo") == null || widget.getValue("insightCombo") == "" && keyPairs != null && keyPairs["insightCombo"] != null) {
              widget.setValue("insightCombo", unescape(keyPairs["insightCombo"]));
          }

          if(widget.getValue("reportName") == null || widget.getValue("reportName") == "" && keyPairs != null && keyPairs["reportName"] != null) {
              widget.setValue("reportName", unescape(keyPairs["reportName"]));
          }

          if(widget.getValue("reportType") == null || widget.getValue("reportType") == "" && keyPairs != null && keyPairs["reportType"] != null) {
              widget.setValue("reportType", unescape(keyPairs["reportType"]));
          }

          contentHtml += '<div style="margin: 0 auto;text-align:center;">';
          contentHtml += '<object type="application/x-shockwave-flash" data="https://www.easy-insight.com/app/easyui-debug/YahooWidgetReport.swf" allowScriptAccess="always" width="550" height="450" class="flash">';
          contentHtml += '<param name="movie" value="https://www.easy-insight.com/app/easyui-debug/YahooWidgetReport.swf" />';
          //contentHtml += '<param name="wmode" value="opaque" />';
          contentHtml += '<embed type="application/x-shockwave-flash" allowScriptAccess="always" allowNetworking="all" src="https://www.easy-insight.com/easyui-debug/YahooWidgetReport.swf" width="550" height="450"></embed>';
          contentHtml += '</object>';
          contentHtml += '</div>';

          widget.setBody(contentHtml);
          widget.onResize();
        }


        widget.onResize = function() {
  var elements = widget.body.getElementsByTagName("object");
  var flash = elements[0];
  if (flash) {
    flash.width = 1;
    flash.width = widget.body.getDimensions().width - 15;
    flash.height = Math.round(flash.width * 3/4);
  }
}

        function parseQueryString(str) {
            var queryVals = str.split("&");
            var keyPairs = new Array();
            for(var i = 0;i < queryVals.length;i++) {
                var splitter = queryVals[i].split("=");
                if(splitter.length == 2) {
                    keyPairs[splitter[0]] = splitter[1];
                }
            }
            return keyPairs;
        }
    </script>

</head>
<body>
    <p>Loading...</p>
</body>
</html>