<div cg-busy="load" />
<div class="row">
    <div class="col-md-12"><h2>Data Sources</h2></div>
</div>
<div class="row">
    <div class="col-md-12"><p>These data sources are the different systems you've connected Easy Insight to. Click on a data source name to navigate to the reports and dashboards built on this data source or to create new reports and dashboards.</p></div>
</div>
<div class="row">
    <div class="browse-by-tag col-md-2">
        <span ng-if="tags && tags.length > 0">Browse by Tag:</span>
    </div>
    <div class="col-md-7">
        <div class="tag-list">
            <a ng-repeat="tag in tags" class="btn btn-default tag-select" ng-class="{selected: tag.enabled, active: tag.enabled}" data-toggle="button" ng-click="toggleTag(tag)">{{ tag.name }}</a>
        </div>
    </div>
    <div class="col-md-3 deleteSelected">
        <button ng-if="user.designer" class="btn btn-danger pull-right" ng-click="delete_selected()">Delete Selected</button>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
    <table class="table table-striped table-bordered table-condensed reportDashboardTable">
        <thead>
        <tr>
            <th ng-if="user.designer" style="width: 42px;"></th>
            <th>Data Source Name</th>
            <th style="width:150px">Last Refresh Time</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="data_source in (filtered = (data_sources | tagged:tags))" ng-init="show_tags = false">
            <td ng-show="user.designer">
                <input type="checkbox" ng-model="data_source.selected" />
                <i class="glyphicon tag-value" ng-class="{'glyphicon-tag': data_source.tags.length == 0, 'glyphicon-tags': data_source.tags.length > 0 }" ng-click="show_tags = !show_tags" />
            </td>
            <td class="header-tr">
                <a href="/a/data_sources/{{data_source.url_key}}">{{data_source.name}}</a>
                <div ng-show="show_tags">Tags: <span ng-repeat="tag in data_source.tags">{{tag.name}} <i class="glyphicon glyphicon-remove tag-value" ng-click="remove_ds_tag(data_source, tag)" /> </span>
                    <input ui-keyup="{'enter': 'add_ds_tag(data_source, null, new_tag)'}" type="text" ng-init="new_tag={}" ng-model="new_tag.text" typeahead="tag.name for tag in tags | filter: {name: $viewValue} | not_tagged:data_source.tags | limitTo: 8" typeahead-on-select="add_ds_tag(data_source, $item, new_tag)" />
                    <i class="glyphicon glyphicon-plus tag-value" ng-click="add_ds_tag(data_source, null, new_tag)" /></div>
            </td>
            <td>
                {{data_source.last_refresh_time}}
            </td>
        </tr>
        <tr ng-if="filtered.length <= 0">
            <td colspan="3">There are no reports for this combination of tags.</td>
        </tr>
        </tbody>
    </table>
    </div>
</div>

