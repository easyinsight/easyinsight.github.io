<?xml version="1.0"?>
<util:TabletFilterRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"
          xmlns:util="com.easyinsight.util.*">
    <fx:Script><![CDATA[
        import com.easyinsight.filtering.FilterDateRangeDefinition;

        import mx.formatters.DateFormatter;


        [Bindable]
        private var filterName:String;

        [Bindable]
        private var filterValue:Object;

        private var lowDate:Date;
		private var highDate:Date;
		private var delta:Number;

        [Bindable]
        private var date1:String;

        [Bindable]
        private var date2:String;

        private var df:DateFormatter;

        override protected function commitProperties():void {
            super.commitProperties();
            df = new DateFormatter();
            df.formatString = "MM/DD/YYYY";
            filterName = filterInfo.filterDefinition.field.display + ":";
            lowDate = FilterDateRangeDefinition(filterInfo.filterDefinition).startDate;
            highDate = new Date();
            date1 = df.format(lowDate);
            date2 = df.format(highDate);
        }

        private function editStartDate():void {
            var window:DatePickerWindow = new DatePickerWindow();
            window.date = lowDate;
            window.addEventListener(DateChoiceEvent.DATE_CHOICE, onLowDateChange, false, 0, true);
            var point:Point = new Point(date1Label.x, date1Label.y);
            var global:Point = localToGlobal(point);
            window.x = global.x;
            window.y = global.y + 20;
            window.open(this, true);
        }

        private function editEndDate():void {
            var window:DatePickerWindow = new DatePickerWindow();
            window.date = highDate;
            window.addEventListener(DateChoiceEvent.DATE_CHOICE, onHighDateChange, false, 0, true);
            var point:Point = new Point(date2Label.x, date2Label.y);
            var global:Point = localToGlobal(point);
            window.x = global.x;
            window.y = global.y + 20;
            window.open(this, true);
        }

        private function onLowDateChange(event:DateChoiceEvent):void {
            lowDate = event.date;
            date1 = df.format(lowDate);
            FilterDateRangeDefinition(filterInfo.filterDefinition).startDate = lowDate;
            dispatchEvent(new FilterChangeEvent(null));
        }

        private function onHighDateChange(event:DateChoiceEvent):void {
            highDate = event.date;
            date2 = df.format(highDate);
            FilterDateRangeDefinition(filterInfo.filterDefinition).endDate = highDate;
            dispatchEvent(new FilterChangeEvent(null));
        }
        ]]></fx:Script>
    <s:Label text="{filterName}"/>
    <s:Label text="{date1}" textDecoration="underline" click="editStartDate()" id="date1Label"/>
    <s:Label text="{date2}" textDecoration="underline" click="editEndDate()" id="date2Label"/>
</util:TabletFilterRenderer>
